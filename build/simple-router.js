!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleRouter=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),l=n(1),u=n(2),s=n(4);t.SimpleRouter=function(){function e(t){o(this,e),this._config=t,this._parser=new DOMParser,this._links=[],this._outlets=[],this._routes=[],this._routerState=[],this._cssLoaded=!1,this._jsLoaded=!1,this._onCssLoaded=null,this._onJsLoaded=null,this._current=null,this._defaultRoute=new u.Route("/",{handler:function(){}},null),this._notFoundRoute=new u.Route(null,{handler:function(){}},""),this.findOutlets(),this.findLinks()}return i(e,[{key:"findOutlets",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"router-outlet",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;this.clearDeadOutlets(),n.querySelectorAll("["+t+"]").forEach(function(n,o,r){n.isRegistered||(n.isRegistered=!0,e._outlets.push(new s.Outlet(n,e.getAttributeValueByName(n,t))))},this)}},{key:"clearDeadOutlets",value:function(){this._outlets=this._outlets.filter(function(e,t,n){var o=document.body.contains(e.element);return!1===o&&(e.element.isRegistered=!1,e.element=null),o})}},{key:"findOutletByName",value:function(e){return this._outlets.find(function(t){return t.name==e},this)}},{key:"findLinks",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"route-url",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;this.clearDeadLinks(),n.querySelectorAll("["+t+"]").forEach(function(t){t.isRegistered||e._links.push(new l.Link(t,e.findOutletByName(e.getAttributeValueByName(t,"route-target")),e.handleLinkClick.bind(e)))},this)}},{key:"clearDeadLinks",value:function(){this._links=this._links.filter(function(e){var t=document.body.contains(e.element);return!1===t&&(e.element.isRegistered=!1,e.element.onclick=null,e.element=null),t})}},{key:"findRoute",value:function(e){var t=e.url==this._defaultRoute.link?this._defaultRoute:null,n=e.url.split("/"),o=null;return t=this._routes.find(function(e){var t=e.routeUrl.split("/"),r=!0;if(t.length===n.length){o={};for(var i=0;i<t.length;i++)if(n[i]===t[i])console.log("these parts match!");else{if(!0!==t[i].startsWith(":")){console.log("no route matches!"),r=!1;break}o[t[i].substring(1)]=n[i]}}else r=!1;return r},this),t||(t=this._notFoundRoute,o={linkProvided:e.url}),{route:t,params:o}}},{key:"handleLinkClick",value:function(e){var t=e.target,n=this._links.find(function(e){return t===e.element}),o=this.findRoute(n),r={link:n,route:o.route,params:o.params};console.log(r),this.handleRoute(r)}},{key:"handleRoute",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.route.postRouteProcessing&&e.route.postRouteProcessing(e),!0===this.shouldFetch(e)?(e.route.preFetchContent&&e.route.preFetchContent(e),this.fetch(e)):(e.templateTextInstance=e.route.content.html.template,this.postFetch(e))}},{key:"fetch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=new XMLHttpRequest;l.open(t,e.route.content.html.url,!0,r,i),l.onerror=this.handleFetchFailure,n&&n.forEach(function(e){l.setRequestHeader(e.name,e.value)},this),l.onreadystatechange=function(){l.readyState===XMLHttpRequest.DONE&&(e.route.content.html.template=l.responseText,e.route.content.html.loaded=!0,e.templateTextInstance=l.responseText,o.postFetch(e))},l.send()}},{key:"handleFetchFailure",value:function(e){throw e}},{key:"postFetch",value:function(e){e.route.postFetchContent&&e.route.postFetchContent(e),this.shouldLoad(e)?(e.route.preContentLoad&&e.route.preContentLoad(e),this.load(e)):this.postLoad(e)}},{key:"load",value:function(e){var t=this,n=document.getElementsByTagName("head")[0],o=!1;e.templateTextInstance&&e.link.outlet.addContentString(e.templateTextInstance);var r=e.route.content;if(r.css&&!r.css.loaded){o=!0;var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=r.css.url,i.media="all",i.onload=function(){e.route.content.css.loaded=!0,t.postLoad(e)},n.appendChild(i)}if(r.js&&!r.js.loaded){o=!0;var l=document.createElement("script");l.type="application/javascript",l.src=r.js.url,l.onload=function(){e.route.content.js.loaded=!0,t.postLoad(e)}}o||this.postLoad(e)}},{key:"postLoad",value:function(e){var t=e.route.content;t.html&&!t.html.loaded||t.css&&!t.css.loaded||t.js&&!t.js.loaded?console.log("Still waiting"):(e.route.postContentLoad&&e.route.postContentLoad(e),e.route.handler&&e.route.handler(e),this._current&&this._routerState.push(this._currnet),this._current=e,e.route.postLinkHandler&&e.route.postLinkHandler(e))}},{key:"shouldFetch",value:function(e){var t=!1,n=e.route.content;return n.html&&n.html.url&&!n.html.loaded&&(t=!0),t}},{key:"shouldLoad",value:function(e){var t=!1,n=e.route.content;return e.templateTextInstance&&(t=!0),!t&&n.css&&n.css.url&&(t=!0),!t&&n.js&&n.js.url&&(t=!0),t}},{key:"handleLifeCycleFailure",value:function(e){console.error("A failure occurred in lifecycle chain!",void 0===e?"undefined":r(e),e)}},{key:"registerRoute",value:function(){"function"==typeof(arguments.length<=0?void 0:arguments[0])?this._defaultRoute.events=new u.Route("/",arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]):"string"==typeof(arguments.length<=0?void 0:arguments[0])&&this._routes.push(new u.Route(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2]))}},{key:"unregisterRoute",value:function(e){this._defaultRoute.url==routeLink&&(this._defaultRoute.events=null)}},{key:"getAttributeValueByName",value:function(e,t){return e.attributes.getNamedItem(t).value}}]),e}()},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});t.Link=function e(t,n,r){o(this,e),this.element=t,this.url=this.element.attributes.getNamedItem("route-url").value,this.outlet=n,this.element.onclick=r,this.element.isRegistered=!0}},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Route=void 0;var r=n(3);t.Route=function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;o(this,e),this.routeUrl=t,this.postRouteProcessing=n.postRouteProcessing,this.preFetchContent=n.preFetchContent,this.postFetchContent=n.postFetchContent,this.handler=n.handler,this.preContentLoad=n.preContentLoad,this.postContentLoad=n.postContentLoad,this.postRouteHandling=n.postRouteHandling;var s=null;i&&(s={},i.innerHTML&&!0===(0,r.isHTMLString)(i.innerHTML)?(s.template=i.innerHTML,s.loaded=!0):!0===(0,r.isHTMLString)(i)?(s.template=i,s.loaded=!0):(s.url=i,s.loaded=!1)),this.content={html:s,css:l?{url:l,loaded:!1}:null,js:u?{url:u,loaded:!1}:null}}},function(e,t,n){"use strict";function o(e){var t=(new DOMParser).parseFromString(e,r);return Array.from(t.body.childNodes).some(function(e){return 1===e.nodeType})}Object.defineProperty(t,"__esModule",{value:!0}),t.isHTMLString=o;var r=t.HTML_MIME="text/html";t.XML_MIME="application/xml",t.CSS_MIME="text/css",t.JS_MIME="application/js"},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.Outlet=function(){function e(t,n){o(this,e),this.element=t,this.name=n}return r(e,[{key:"hasContent",value:function(){return 0!==this.element.children.length}},{key:"clearOutlet",value:function(){for(;this.element.children.length>0;)this.element.removeChild(this.element.children[0])}},{key:"addContentString",value:function(e){this.element.innerHTML=e}},{key:"addContent",value:function(e){this.element.appendChild(e)}}]),e}()}])});
//# sourceMappingURL=simple-router.js.map